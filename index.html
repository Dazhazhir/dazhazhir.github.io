<!DOCTYPE html>
<html>
<head>
<title>Dazhazhir Dictionary</title>
<meta charset="UTF-8">
<style>
/* (Keep all the existing CSS exactly as it was) */
body {
    font-family: Arial, sans-serif;
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
    line-height: 1.6;
    color: black;
    background: white;
    position: relative;
}
/* ... ALL EXISTING CSS REMAINS THE SAME ... */
</style>
</head>
<body>
<!-- More Button -->
<button class="more-button" id="moreButton">More</button>

<!-- More Popup -->
<div id="morePopupContainer"></div>

<h1>Dazhazhir Dictionary</h1>

<!-- Word popup will be inserted here -->
<div id="wordPopupContainer"></div>

<!-- Filter controls will be inserted here -->
<div id="filterControlsContainer"></div>

<!-- Dictionary content will be loaded here -->
<div id="dictionaryContent">
    <div style="text-align: center; padding: 50px; color: #666;">
        Loading dictionary...
    </div>
</div>

<div class="word-count" id="wordCount"></div>
<div class="search-info" id="searchInfo"></div>

<script>
// Function to load words from words.txt
async function loadWords() {
    try {
        const response = await fetch('words.txt');
        if (!response.ok) {
            throw new Error(`Failed to load words.txt: ${response.status}`);
        }
        const text = await response.text();
        
        // Split the text into individual word entries
        const wordEntries = text.split('\n\n').filter(entry => entry.trim() !== '');
        
        // Clear loading message
        document.getElementById('dictionaryContent').innerHTML = '';
        
        // Group words by first letter
        const groupedWords = {};
        
        wordEntries.forEach(entry => {
            // Extract the word from the HTML
            const match = entry.match(/data-word="([^"]+)"/);
            if (match) {
                const word = match[1];
                const firstLetter = word.charAt(0).toUpperCase();
                
                if (!groupedWords[firstLetter]) {
                    groupedWords[firstLetter] = [];
                }
                groupedWords[firstLetter].push(entry);
            }
        });
        
        // Sort letters alphabetically
        const sortedLetters = Object.keys(groupedWords).sort();
        
        // Add letter headings and words
        const dictionaryContent = document.getElementById('dictionaryContent');
        
        sortedLetters.forEach(letter => {
            // Add letter heading
            const heading = document.createElement('div');
            heading.className = 'letter-heading';
            heading.id = `letter-${letter}`;
            heading.textContent = letter;
            dictionaryContent.appendChild(heading);
            
            // Add all words for this letter
            groupedWords[letter].forEach(entry => {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = entry.trim();
                const wordElement = tempDiv.firstElementChild;
                
                // Add click event listener
                wordElement.addEventListener('click', () => showWordPopup(wordElement));
                
                dictionaryContent.appendChild(wordElement);
            });
        });
        
        // Update word count and initialize everything
        updateWordCount();
        addEventListenersToWords();
        applyFilters();
        
    } catch (error) {
        console.error('Error loading words:', error);
        document.getElementById('dictionaryContent').innerHTML = 
            `<div style="text-align: center; padding: 50px; color: #cc0000;">
                Error loading dictionary: ${error.message}<br>
                Make sure words.txt is in the same directory.
            </div>`;
    }
}

// Updated showMorePopup function with Overview link
function showMorePopup() {
    const popupHTML = `
    <div class="more-popup-overlay" id="morePopup">
        <div class="more-popup">
            <button class="popup-close" id="morePopupCloseBtn">&times;</button>
            <h2>More Resources</h2>
            <div class="more-popup-buttons">
                <a href="Dazhazhir.pdf" class="more-popup-btn" target="_blank">üìò Overview (PDF)</a>
                <a href="#" class="more-popup-btn" onclick="exportDictionary(); return false;">üì• Export Dictionary</a>
                <button class="more-popup-btn" onclick="printDictionary()">üñ®Ô∏è Print Dictionary</button>
            </div>
        </div>
    </div>
    `;
    document.getElementById('morePopupContainer').innerHTML = popupHTML;
    document.getElementById('morePopupCloseBtn').addEventListener('click', closeMorePopup);
    document.getElementById('morePopup').addEventListener('click', function(e) {
        if (e.target === this) {
            closeMorePopup();
        }
    });
    document.body.style.overflow = 'hidden';
}

function printDictionary() {
    window.print();
}

// Function to add click event listeners to all word entries
function addEventListenersToWords() {
    document.querySelectorAll('.word-entry').forEach(entry => {
        entry.addEventListener('click', () => showWordPopup(entry));
    });
}

// Updated function to add filter controls
function addFilterControls() {
    const filterHTML = `
    <div class="filter-controls">
        <div class="filter-group">
            <div class="filter-label">Search Type:</div>
            <select id="searchType" class="filter-select">
                <option value="all" selected>All Fields</option>
                <option value="word">Dazhazhir Word</option>
                <option value="definition">Definition</option>
                <option value="synonyms">English Synonyms</option>
            </select>
        </div>
        <div class="filter-group">
            <div class="filter-label">Part of Speech:</div>
            <select id="posFilter" class="filter-select">
                <option value="all" selected>All Parts</option>
                <option value="noun">Nouns</option>
                <option value="verb">Verbs</option>
                <option value="adjective">Adjectives</option>
                <option value="pronoun">Pronouns</option>
                <option value="preposition">Prepositions</option>
                <option value="prefix">Prefixes</option>
                <option value="suffix">Suffixes</option>
                <option value="particle">Particles</option>
                <option value="number">Numbers</option>
                <option value="operator">Operators</option>
            </select>
        </div>
        <div class="filter-group">
            <div class="filter-label">Search:</div>
            <input type="text" id="searchBox" placeholder="Type to search all fields..." style="padding: 8px; width: 200px; border: 2px solid #ccc; border-radius: 5px;">
        </div>
        <div class="filter-group">
            <div class="filter-label">Options:</div>
            <div class="checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="hideEmptyLetters" class="filter-checkbox" checked> Hide empty letters
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="showCounts" class="filter-checkbox" checked> Show counts
                </label>
            </div>
        </div>
        <div style="clear: both; margin-top: 10px;">
            <button id="resetFilters" style="padding: 8px 15px; background: #666; color: white; border: none; border-radius: 5px; cursor: pointer;">
                Reset All Filters
            </button>
        </div>
    </div>
    `;
    
    // Insert filter controls after the h1
    document.querySelector('h1').insertAdjacentHTML('afterend', filterHTML);
    
    // Add event listeners for filters
    document.getElementById('searchBox').addEventListener('input', applyFilters);
    document.getElementById('searchType').addEventListener('change', applyFilters);
    document.getElementById('posFilter').addEventListener('change', applyFilters);
    document.getElementById('hideEmptyLetters').addEventListener('change', applyFilters);
    document.getElementById('showCounts').addEventListener('change', updateSearchInfo);
    document.getElementById('resetFilters').addEventListener('click', resetFilters);
}

// (Keep all other functions exactly as they were: closeMorePopup, showWordPopup, closePopup, shareWord, copyWordDetails, checkUrlForWord, addVerticalLetterNav, highlightCurrentLetter, applyFilters, updateSearchInfo, resetFilters, exportDictionary, updateWordCount, etc.)

// ... ALL OTHER FUNCTIONS REMAIN THE SAME ...

function updateWordCount() {
    const count = document.querySelectorAll('.word-entry').length;
    document.getElementById('wordCount').textContent = `Total words in dictionary: ${count}`;
    document.title = `Dazhazhir Dictionary (${count} words)`;
}

// Modified DOMContentLoaded event listener
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('moreButton').addEventListener('click', showMorePopup);
    
    // Add vertical letter navigation
    addVerticalLetterNav();
    
    // Add filter controls
    addFilterControls();
    
    // Load words from external file
    loadWords();
    
    // Check URL for word parameter
    window.addEventListener('popstate', function(event) {
        checkUrlForWord();
    });
    
    // Initial check for URL word parameter
    checkUrlForWord();
    
    // Add export button
    const exportBtn = document.createElement('button');
    exportBtn.className = 'export-btn';
    exportBtn.textContent = 'Export Dictionary as JSON';
    exportBtn.onclick = exportDictionary;
    const wordCount = document.getElementById('wordCount');
    wordCount.parentNode.insertBefore(exportBtn, wordCount.nextSibling);
    
    // Add last updated date
    const dateElement = document.createElement('div');
    dateElement.style.textAlign = 'center';
    dateElement.style.color = '#666';
    dateElement.style.fontSize = '0.9em';
    dateElement.style.marginTop = '20px';
    dateElement.textContent = `Last updated: ${new Date().toLocaleDateString()}`;
    document.body.appendChild(dateElement);
});
</script>
</body>
</html>
